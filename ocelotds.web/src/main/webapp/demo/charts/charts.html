<script src="https://code.highcharts.com/stock/highstock.js"></script>
<script src="https://code.highcharts.com/stock/modules/exporting.js"></script>
<div class="container-fluid">
	<div class="well col-md-4">
		<div class="demotitle">
			<img class="logo pull-left" title="Ocelotds" src="../../assets/ocelot_128x128.png" alt="Ocelotds"/>
			<img src="http://www.highcharts.com/media/templates/highsoft_bootstrap/images/logo.svg" width="300" alt="HighChart"/>
		</div>
		<div id="graph-area" style="min-width: 310px; height: 400px; margin: 0 auto"></div>
	</div>
	<div class="well col-md-8">
		<!-- Nav tabs -->
		<ul class="nav nav-tabs" role="tablist">
			<li role="presentation" class="active"><a href="#about"	aria-controls="about"	role="tab" data-toggle="tab">About</a></li>
			<li role="presentation">					<a href="#java1"	aria-controls="java1"	role="tab" data-toggle="tab">ChartServices.java</a></li>
			<li role="presentation">					<a href="#java2"	aria-controls="java2"	role="tab" data-toggle="tab">DataMarshaller.java</a></li>
			<li role="presentation">					<a href="#js1"		aria-controls="js1"		role="tab" data-toggle="tab">Javascript</a></li>
			<li role="presentation">					<a href="#html1"	aria-controls="html1"	role="tab" data-toggle="tab">Html</a></li>
		</ul>
		<!-- Tab panes -->
		<div class="tab-content">
			<div role="tabpanel" class="tab-pane active" id="about">
				<h2>About demo : HighChart and <span style="color:gray">Ocelot</span><span style="color:chocolate">ds</span>...</h2>
				<p>This is a demonstration base on <a href="http://www.highcharts.com/demo/dynamic-update">highcharts</a>.<br>With Ocelot your front end application communicate elegantly with your java back-end</p>
				<p>This shows how to implement a dynamic chart.</p>
				<p>Two java classes are used. First one is an EJB Scheduler and publishes every seconds to all subscribers new datas.<br>The second one is optional and marshall Date and Float objects to json string.<br>The last one is just for illustrate the mecanism of marshaller.</p>
				<p>Hover the mouse <span class="cc" title="That's it !!!">&nbsp;highlighted code&nbsp;</span> and get infos about it</p>
			</div>
			<div role="tabpanel" class="tab-pane" id="java1">
				<p>Hover the mouse <span class="cc" title="That's it !!!">&nbsp;highlighted code&nbsp;</span> and get infos about it</p>
				<p>This EJB Scheduler publish every seconds data to all subscribers.</p>
				<pre><code class="java">@Singleton
@Startup
public class ChartServices {
   <b class="cc" title="Inject the events dispacher">@Inject</b>
   <b class="cc" title="Specify the topic">@JsTopicEvent("values")</b>
   <b class="cc" title="Specify the marshaller if you want">@JsonMarshaller(DataMarshaller.class)</b>
   Event&lt;Object&gt; wsEvent;

   @Schedule(dayOfWeek = "*", month = "*", hour = "*", dayOfMonth = "*", year = "*", minute = "*", second = "*/1", persistent = false)
   public void getValues() {
      Random randomGenerator = new Random();
      <b class="cc" title="Dispatch payload to all clients">topicEvent.fire</b>(new Object[]{new Date(), randomGenerator.nextFloat()});
   }
}</code></pre>
			</div>
			<div role="tabpanel" class="tab-pane" id="java2">
				<p>Hover the mouse <span class="cc" title="That's it !!!">&nbsp;highlighted code&nbsp;</span> and get infos about it</p>
				<p>This class is optional, it illustrate marshaller mecanism if you want to control the serialization.</p>
				<pre><code class="java">public class DataMarshaller implements JsonMarshaller&lt;Object&gt;{
   @Override
   public String toJson(Object obj) throws JsonMarshallingException {
      Object[] datas = (Object[]) obj;
      Date d = (Date) datas[0];
      float f = (float) datas[1];
      return String.format("[%s,%s]", d.getTime(), f);
   }
}</code></pre>
			</div>
			<div role="tabpanel" class="tab-pane" id="js1">
				<p>Hover the mouse <span class="cc" title="That's it !!!">&nbsp;highlighted code&nbsp;</span> and get infos about it</p>
				<p>This script is mainly highcharts code, only subscriber is part of ocelotds.</p>
				<pre><code class="js">'use strict';
<b class="cc" title="Observe when the websocket connection is open for init the chart">ocelotController.addOpenListener</b>(function () {
   new ChartServices().<b class="cc" title="Get initial datas. 1000 samples">getDatas(1000)</b>.then(function(<b class="cc" title="This is the payload">datas</b>) {
      var chart = new Highcharts.StockChart({
         chart: {renderTo: 'graph-area'},
         rangeSelector: {
            buttons: [
               {count: 30, type: 'second', text: '30s'},
               {count: 2, type: 'minute', text: '2m'},
               {count: 5, type: 'minute', text: '5m'},
               {type: 'all', text: 'All'}
            ],
            inputEnabled: false,
            selected: 0
         },
         title: {text: 'Live random data'},
         exporting: {enabled: true},
         series: [{data: datas}]
      });
   });
   <b class="cc" title="Subscribe to topic named 'values'">new Subscriber("values")</b>.message(<b class="cc" title="Handler when message is post in topic">function</b> (vals) {
      chart.series[0].addPoint([vals[0], vals[1]], true, true);
   });
});
<b class="cc" title="Observe when the websocket connection is close.">ocelotController.addCloseListener</b>(function () {
   <b class="cc" title="Re-open connection.">ocelotController.open();</b>
});
</code></pre>
			</div>
			<div role="tabpanel" class="tab-pane" id="html1">
				<p>Hover the mouse <span class="cc" title="That's it !!!">&nbsp;highlighted code&nbsp;</span> and get infos about it</p>
				<pre><code class="html">&lt;script src="http://code.highcharts.com/highcharts.js"&gt;&lt;/script&gt;
...
&lt;div id="graph-area" style="min-width: 310px; height: 400px; margin: 0 auto"&gt;&lt;/div&gt;</code></pre>
			</div>
		</div>
	</div>
</div>
<script src="charts.js"></script>

