<div class="container theme-showcase" role="main">
	<div class="well">
		<h2>How to use :</h2>
		<h3>Dependencies</h3>
		<h4>For WAR Package</h4>
		<p>Add <em>ocelot-web</em> dependency in your maven web project</p>
		<pre><code class="xml">
&lt;dependency&gt;
   &lt;groupId&gt;org.ocelotds&lt;/groupId&gt;
   &lt;artifactId&gt;ocelot-web&lt;/artifactId&gt;
   &lt;version&gt;${ocelot.version}&lt;/version&gt;
&lt;/dependency&gt;
		</code></pre>
		<h4>For EAR Package</h4>
		<p>Add <em>ocelot-core</em> dependency in your maven ejb module project</p>
		<pre><code class="xml">
&lt;dependency&gt;
   &lt;groupId&gt;org.ocelotds&lt;/groupId&gt;
   &lt;artifactId&gt;ocelot-core&lt;/artifactId&gt;
   &lt;version&gt;${ocelot.version}&lt;/version&gt;
&lt;/dependency&gt;
		</code></pre>
		<p>Add <em>ocelot-web</em> dependency in your maven web module project</p>
		<pre><code class="xml">
&lt;dependency&gt;
   &lt;groupId&gt;org.ocelotds&lt;/groupId&gt;
   &lt;artifactId&gt;ocelot-web&lt;/artifactId&gt;
   &lt;version&gt;${ocelot.version}&lt;/version&gt;
&lt;/dependency&gt;
		</code></pre>
		<p>Don’t add anything else in ear pom.xml_ (except your own dependencies). Add ocelot only in ejb.jar modules and web.war module, only one web module.</p>
		<h3>beans.xml</h3>
		<p>In all modules, web and ejb add bean.xml.</p>
		<p>But becarefull, don’t add attribute <em>bean-discovery-mode=”annotated”</em><br />
			Your beans.xml should be like this :</p>
		<pre><code class="xml">
&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;beans xmlns="http://xmlns.jcp.org/xml/ns/javaee"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xsi:schemaLocation="http://xmlns.jcp.org/xml/ns/javaee http://xmlns.jcp.org/xml/ns/javaee/beans_1_1.xsd"
       bean-discovery-mode="all"&gt;
&lt;/beans&gt;
		</code></pre>
		<p>In web module add beans.xml in src/main/webapp/WEB-INF</p>
		<p>In ejb module add beans.xml in src/main/resources/META-INF</p>
		<h3 id="annotate-classe-service">Annotate classe service</h3>
		<p>Declare service as accessible from javascript front end</p>
		<pre><code class="java">
@Stateless
@DataService(resolver = Constants.Resolver.EJB)
public class TestEJBService {
		</code></pre>
		<h3>If you need services be cached on client annotate method</h3>
		<pre><code class="java">
@Stateless
@DataService(resolver = Constants.Resolver.EJB)
public class TestEJBService {
   String getMessage(int i) {...}
   @JsCacheResult(minute=2)
   String getMessageCached() {...} // this service will be cached during 2 minute on the client
}
		</code></pre>
		<h3>For remove cache from front-end just call method annotated with cache method information</h3>
		<pre><code class="java">
@Stateless
@DataService(resolver = Constants.Resolver.EJB)
public class TestEJBService {
   String getMessage(int i) {...}
   @JsCacheResult(minute=2)
   String getMessageCached() {...} // this service will be cached during 2 minute on the client
   @JsCacheRemove(cls = TestEJBService.class, methodName = "getMessageCached")
   String addMessage(String newEntry) {...} // this service will remove the cache on all client
}
		</code></pre>
		<p>Compilation generate javascript stub by introspection of annotated classes</p>
		<h3>Add Framework to html</h3>
		<p>Add core and generated services in html page (those scripts are provided by ocelot servlets)</p>
		<pre><code class="html">
&lt;body&gt;
	&lt;script src="ocelot.js" type="text/javascript"&gt;&lt;/script&gt;
		</code></pre>
		<h3>Use it</h3>
		<p>Use services directly in your code</p>
		<pre><code class="javascript">
var srv = new TestEJBService();
srv.getMessage(Math.floor(Math.random()*10)).event(function (evt) {
   if(evt.type === "RESULT") {
      doSomethingWithResult(evt.result);
   } else {
      doSomethingWithFault(evt.fault);
   }
}).then(function (result) {
   doSomethingWithResult(result);
}).then(function (result) {
   doSomethingWithResult(result);
}, function (fault) {
   doSomethingWithFault(fault);
}).catch(function (fault) {
   doSomethingWithFault(fault);
});
		</code></pre>
		<h3 id="notifications">Notifications</h3>
		<p>Message Driven bean features, can be used to implement a chat for example or notify something to the client.</p>
		<h4>create TopicConsumer</h4>
		<p>In javascript, create an instance of TopicConsumer</p>
		<pre><code class="javascript">
var sub = new Subscriber("mytopic").then(function (res) {
  subscriptionOk();
}).catch(function (f) {
  subscriptionNok();
}).message(function (msg) {
   doSomethingWithMsg(msg); 
});

sub.unsubscribe().then(function (res) {
	unsubscriptionOk();
}).catch(function (f) {
   unsubscriptionNok();
});
		</code></pre>
		<h4 id="publish-message">publish message</h4>
		<p>In java, publish message to all subcriber clients</p>
		<pre><code class="java">
@Inject
	@MessageEvent
	Event&lt;MessageToClient&gt; wsEvent;

	public void publish() {
		MessageToClient messageToClient = new MessageToClient();
		messageToClient.setId("mytopic");
		messageToClient.setResult("Message From server");
		wsEvent.fire(messageToClient);
	}
		</code></pre>
	</div>
	<div id="disqus_thread"></div>
	<script type="text/javascript">
		var disqus_shortname = 'ocelot';
		/* * * DON'T EDIT BELOW THIS LINE * * */
		(function () {
			var dsq = document.createElement('script');
			dsq.type = 'text/javascript';
			dsq.async = true;
			dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
			(document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
		})();
	</script>
	<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>
</div>
